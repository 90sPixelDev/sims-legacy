<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta
			name="viewport"
			content="width=device-width, initial-scale=1.0, minimum-scale=1.0"
		/>
		<link rel="stylesheet" type="text/css" href="styles.css" />
		<title>Sims Legacy</title>
	</head>
	<body>
		<div style="width: 100%; height: 100%" id="tree"></div>
		<script src="familytree.js"></script>
		<script>
			FamilyTree.templates.base.defs = `<g transform="matrix(0.05,0,0,0.05,-12,-9)" id="heart">
			     <path d="M438.482,58.61c-24.7-26.549-59.311-41.655-95.573-41.711c-36.291,0.042-70.938,15.14-95.676,41.694l-8.431,8.909 l-8.431-8.909C181.284,5.762,98.663,2.728,45.832,51.815c-2.341,2.176-4.602,4.436-6.778,6.778 c-52.072,56.166-52.072,142.968,0,199.134l187.358,197.581c6.482,6.843,17.284,7.136,24.127,0.654 c0.224-0.212,0.442-0.43,0.654-0.654l187.29-197.581C490.551,201.567,490.551,114.77,438.482,58.61z"/>
			     </g>
			`;

			// CUSTOM TEMPLATE DECLARATION
			FamilyTree.templates.sim = Object.assign(
				{},
				FamilyTree.templates.base
			);
			FamilyTree.templates.sim.defs = '';

			FamilyTree.templates.sim.field_0 =
				'<text ' +
				FamilyTree.attr.width +
				'="195" style="font-size: 20px;font-weight:bold;" fill="black" x="105" y="26" text-anchor="left" data-text-overflow="ellipsis" >{val}</text>';

			FamilyTree.templates.sim.link =
				'<path stroke="#000" stroke-width="3px" fill="none" data-l-id="[{id}][{child-id}]" d="M{xa},{ya} C{xb},{yb} {xc},{yc} {xd},{yd}" />';

			// CUSTOM TEMPLATE PART DEFINITIONS
			FamilyTree.templates.sim.size = [325, 100];
			// FamilyTree.templates.sim.node = '<rect width="300" height="100" fill="#bfe3bf" />';
			FamilyTree.templates.sim.node =
				'<rect x="0" y="0" height="100" width="100" fill="darkseagreen" stroke-width="3" stroke="darkgreen" rx="5" ry="5"></rect>' +
				'<rect x="0" y="0" height="30" width="{w}" fill="#fff" stroke-width="1" stroke="darkgreen" rx="5" ry="5"></rect>' +
				'<line x1="0" y1="30" x2="298.5" y2="30" stroke-width="5" stroke="darkseagreen"></line>';

			FamilyTree.templates.sim.img_0 = `
				<line x1="100" y1="0" x2="100" y2="100" stroke-width="1.5" stroke="black"></line>
				<clipPath id="ulaImg">
						<rect width="100" height="100" x="0" y="0"></rect>
				</clipPath>
				<image preserveAspectRatio="xMidYMid slice" clip-path="url(#ulaImg)" xlink:href="{val}" x="0" y="0" width="100" height="100"></image>`;

			FamilyTree.templates.sim_male = Object.assign(
				{},
				FamilyTree.templates.sim
			);
			FamilyTree.templates.sim_male.node =
				'<rect x="0" y="0" height="{h}" width="{w}" fill="darkseagreen" stroke-width="3" stroke="darkgreen" rx="5" ry="5"></rect>' +
				'<rect x="0" y="0" height="40" width="{w}" fill="#fff" stroke-width="1" stroke="darkgreen" rx="5" ry="5"></rect>' +
				'<line x1="1.5" y1="40" x2="322.5" y2="40" stroke-width="5" stroke="darkseagreen"></line>';

			FamilyTree.templates.sim_female = Object.assign(
				{},
				FamilyTree.templates.sim
			);
			FamilyTree.templates.sim_female.node =
				'<rect x="0" y="0" height="{h}" width="{w}" fill="darkseagreen" stroke-width="3" stroke="darkgreen" rx="5" ry="5"></rect>' +
				'<rect x="0" y="0" height="40" width="{w}" fill="#fff" stroke-width="1" stroke="darkgreen" rx="5" ry="5"></rect>' +
				'<line x1="1.5" y1="40" x2="322.5" y2="40" stroke-width="5" stroke="darkseagreen"></line>';

			// RIPPLE
			FamilyTree.templates.sim.ripple = {
				radius: 0,
				color: 'none',
				rect: null,
			};

			FamilyTree.templates.sim.pointer =
				'<g data-pointer="pointer" transform="matrix(0,0,0,0,100,100)">><g transform="matrix(0.3,0,0,0.3,-17,-17)">' +
				'<polygon fill="rgb(0, 202, 40)" stroke="green" stroke-width="5" points="120,250 50,125 120,-25 190,123" />' +
				'<line x1="120" y1="-20" x2="100" y2="120" stroke-width="5" stroke="green"></line>' +
				'<line x1="120" y1="-20" x2="140" y2="120" stroke-width="5" stroke="green"></line>' +
				'<line x1="120" y1="250" x2="140" y2="120" stroke-width="5" stroke="green"></line>' +
				'<line x1="120" y1="250" x2="100" y2="120" stroke-width="5" stroke="green"></line>' +
				'<line x1="47" y1="123" x2="100" y2="127" stroke-width="5" stroke="green"></line>' +
				'<line x1="190" y1="123" x2="100" y2="130" stroke-width="5" stroke="green"></line>' +
				'<circle fill="rgb(0, 90, 0)" cx="120" cy="120" r="30" />' +
				'</g></g>';

			var editForm = function () {};

			editForm.prototype.init = function (obj) {};

			editForm.prototype.show = function (node) {};

			editForm.prototype.hide = function (showldUpdateTheNode) {};

			const family = new FamilyTree(document.getElementById('tree'), {
				// orientation: FamilyTree.orientation.left,
				mouseScrool: FamilyTree.action.zoom,
				mode: 'light',
				template: 'sim',
				roots: [3],
				// miniMap: true,
				nodeTreeMenu: true,
				nodeBinding: {
					field_0: 'name',
					field_1: 'lifestate',
					field_2: 'traits',
					img_0: 'photo',
				},
				// editUI: new editForm(),
				editForm: {
					titleBinding: 'name',
					photoBinding: 'photo',
					buttons: {
						edit: {
							icon: FamilyTree.icon.edit(24, 24, '#fff'),
							text: 'Edit',
							hideIfEditMode: true,
							hideIfDetailsMode: false,
						},
						share: null,
						pdf: null,
					},
					addMoreBtn: 'Add element',
					addMore: 'Add more info',
					addMoreFieldName: 'Element name',
					generateElementsFromFields: false,
					elements: [
						[
							{
								type: 'textbox',
								label: 'Full Name',
								binding: 'name',
							},
							{
								type: 'select',
								options: [
									{ value: 'human', text: 'Human' },
									{
										value: 'vampire',
										text: 'Vampire',
									},
									{
										value: 'wereworlf',
										text: 'Wereworlf',
									},
									{ value: 'alien', text: 'Alien' },
									{
										value: 'mermaid',
										text: 'Mermaid',
									},
									{
										value: 'spellcaster',
										text: 'Spellcaster',
									},
									{
										value: 'plantsim',
										text: 'Plantsim',
									},
									{ value: 'ghost', text: 'Ghost' },
								],
								label: 'Lifestate',
								binding: 'lifestate',
							},
						],
						{
							type: 'select',
							options: [
								{
									value: 'ambitious',
									text: 'ambitious',
								},
								{ value: 'stubborn', text: 'stubborn' },
							],
							label: 'Traits',
							binding: 'traits',
						},
						{
							type: 'textbox',
							label: 'Photo Url',
							binding: 'photo',
							btn: 'Upload',
						},
					],
				},
			});

			family.on('render-link', function (sender, args) {
				var cnodeData = family.get(args.cnode.id);
				var nodeData = family.get(args.node.id);

				if (
					args.cnode.ppid != undefined &&
					cnodeData.married == undefined &&
					nodeData.married == undefined
				) {
					args.html +=
						'<use xlink:href="#heart" fill="blue" x="' +
						args.p.xa +
						'" y="' +
						args.p.ya +
						'"/>';
				} else if (args.cnode.ppid != undefined) {
					args.html +=
						'<use xlink:href="#heart" fill="red" x="' +
						args.p.xa +
						'" y="' +
						args.p.ya +
						'"/>';
				} else if (
					cnodeData.divorced != undefined &&
					nodeData.divorced != undefined &&
					cnodeData.divorced.includes(args.node.id) &&
					nodeData.divorced.includes(args.cnode.id)
				) {
					// console.log(args.html);
					args.html = args.html.replace(
						'path',
						"path stroke-dasharray='4, 3' stroke='#000'"
					);
				}
			});

			family.load([
				{
					id: 1,
					pids: [3],
					divorced: [3],
					gender: 'male',
					photo: 'photos/0d853356-550c-428c-8a22-182b09e633dd.png',
					name: 'Zeph Daniels',
					lifestate: 'human',
					traits: ['stubborn'],
				},
				{
					id: 2,
					pids: [3],
					married: [3],
					gender: 'male',
					photo: 'photos/0d853356-550c-428c-8a22-182b09e633dd.png',
					name: 'Rowan Annable',
					lifestate: 'vampire',
					traits: ['stubborn'],
				},
				{
					id: 3,
					pids: [1, 2],
					married: [2],
					divorced: [1],
					gender: 'female',
					photo: 'photos/0d853356-550c-428c-8a22-182b09e633dd.png',
					name: 'Laura Shepherd',
					lifestate: 'alien',
					traits: ['stubborn'],
				},
				{
					id: 4,
					pids: [5],
					name: 'Robert Jasper',
					photo: 'photos/0d853356-550c-428c-8a22-182b09e633dd.png',
				},
				{
					id: 5,
					pids: [4],
					name: 'Lois Sowle',
					gender: 'female',
					photo: 'photos/0d853356-550c-428c-8a22-182b09e633dd.png',
					traits: ['stubborn'],
				},
				{
					id: 6,
					mid: 2,
					fid: 3,
					pids: [7],
					lovers: [7],
					gender: 'female',
					photo: 'photos/0d853356-550c-428c-8a22-182b09e633dd.png',
					name: 'Tyler Heath',
					lifestate: 'plantsim',
					traits: ['stubborn'],
				},
				{
					id: 7,
					pids: [6],
					mid: 5,
					fid: 4,
					lovers: [6],
					gender: 'male',
					photo: 'photos/0d853356-550c-428c-8a22-182b09e633dd.png',
					name: 'Samson Stokes',
					lifestate: 'werewolf',
					traits: ['stubborn'],
				},
				{
					id: 8,
					mid: 7,
					fid: 6,
					gender: 'female',
					photo: 'photos/0d853356-550c-428c-8a22-182b09e633dd.png',
					name: 'Celeste Castillo De la Riva Ontaira',
					lifestate: 'ghost',
					traits: ['stubborn'],
				},
			]);
		</script>
	</body>
</html>
